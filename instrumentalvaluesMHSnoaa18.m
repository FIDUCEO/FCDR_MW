%
 % Copyright (C) 2016-10-17 Imke Hans
 % This code was developed for the EC project ÒFidelity and Uncertainty in   
 %  Climate Data Records from Earth Observations (FIDUCEO)Ó. 
 % Grant Agreement: 638822
 %  <Version> Reviewed and approved by <name, instituton>, <date>
 %
 % This program is free software; you can redistribute it and/or modify it
 % under the terms of the GNU General Public License as published by the Free
 % Software Foundation; either version 3 of the License, or (at your option)
 % any later version.
 % This program is distributed in the hope that it will be useful, but WITHOUT
 % ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 % FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
 % more details.
 % 
 % A copy of the GNU General Public License should have been supplied along
 % with this program; if not, see http://www.gnu.org/licenses/
%

% run this script to write instrument values to variables

% to find values look into /scratch/uni/u237/sw/AAPP7/AAPP/data/calibration/coef/mhs
%%%%%%% MHS NOAA18 %%%%%%%

%% central frequencies of channels 1-5
f=10^9*[89.0;157.0;183.31;183.31;190.31];

%% band correction factors
bcfa=[0.000 0.000 0.000 -0.0031 0.000];
bcfb=[1.0 1.0 1.0 1.00027 1.0 ];

%% antenna pattern correction:
% for each channel there are 90 values
% indicating the fraction of the earth signal of the total signal (?)
% values in /scratch/uni/u237/sw/AAPP7/AAPP/data/preproc/fdf.dat  for each
% instrument per satellite

%C0 for earth view
CMBPL1correctionC0(1,:)=reshape([0.997074 0.997264 0.997422 0.997581 0.997737 0.998033 0.998167 0.998285 0.998391 0.998501 
0.998597 0.998700 0.998823 0.998946 0.999081 0.999322 0.999399 0.999474 0.999532 0.999595
0.999658 0.999715 0.999764 0.999835 0.999873 0.999945 0.999962 0.999975 0.999983 0.999988
0.999991 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000
1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000
1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000 1.000000
1.000000 1.000000 0.999997 0.999995 0.999992 0.999979 0.999969 0.999956 0.999940 0.999922
0.999887 0.999848 0.999802 0.999754 0.999706 0.999604 0.999533 0.999449 0.999376 0.999296
0.999209 0.999115 0.999022 0.998927 0.998797 0.998488 0.998299 0.998000 0.997614 0.997189].',[1], [90]);

CMBPL1correctionC0(2,:)=reshape([0.999128	0.999153	0.999178	0.999199	0.999219	0.999256	0.999268	0.999282	0.999296	0.999309
0.999322	0.999332	0.999340	0.999350	0.999360	0.999380	0.999387	0.999393	0.999398	0.999401
0.999405	0.999408	0.999546	0.999630	0.999677	0.999748	0.999783	0.999814	0.999852	0.999889
0.999959	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000
1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000
1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000
1.000000	1.000000	1.000000	0.999999	1.000000	0.999999	0.999998	0.999997	0.999995	0.999993
0.999989	0.999986	0.999984	0.999982	0.999981	0.999975	0.999970	0.999963	0.999957	0.999949
0.999937	0.999925	0.999907	0.999883	0.999848	0.999744	0.999683	0.999600	0.999488	0.999382].',[1], [90]);


CMBPL1correctionC0(3,:)=reshape([0.998616	0.998643	0.998665	0.998686	0.998706	0.998742	0.998758	0.998773	0.998786	0.998798
0.998807	0.998864	0.998920	0.998980	0.999039	0.999151	0.999203	0.999254	0.999304	0.999354
0.999402	0.999451	0.999611	0.999692	0.999716	0.999853	0.999852	0.999879	0.999938	0.999938
0.999979	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000
1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000
1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000
1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000
1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	0.999996	0.999992	0.999985
0.999980	0.999972	0.999965	0.999956	0.999941	0.999893	0.999860	0.999829	0.999778	0.999734].',[1], [90]);

CMBPL1correctionC0(4,:)=reshape([0.997074	0.997264	0.997422	0.997581	0.997737	0.998033	0.998167	0.998285	0.998391	0.998501
0.998597	0.998700	0.998823	0.998946	0.999081	0.999322	0.999399	0.999474	0.999532	0.999595
0.999658	0.999715	0.999764	0.999835	0.999873	0.999945	0.999962	0.999975	0.999983	0.999988
0.999991	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000
1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000
1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000
1.000000	1.000000	0.999997	0.999995	0.999992	0.999979	0.999969	0.999956	0.999940	0.999922
0.999887	0.999848	0.999802	0.999754	0.999706	0.999604	0.999533	0.999449	0.999376	0.999296
0.999209	0.999115	0.999022	0.998927	0.998797	0.998488	0.998299	0.998000	0.997614	0.997189].',[1], [90]);

CMBPL1correctionC0(5,:)=reshape([0.999128	0.999153	0.999178	0.999199	0.999219	0.999256	0.999268	0.999282	0.999296	0.999309
0.999322	0.999332	0.999340	0.999350	0.999360	0.999380	0.999387	0.999393	0.999398	0.999401
0.999405	0.999408	0.999546	0.999630	0.999677	0.999748	0.999783	0.999814	0.999852	0.999889
0.999959	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000
1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000
1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000	1.000000
1.000000	1.000000	1.000000	0.999999	1.000000	0.999999	0.999998	0.999997	0.999995	0.999993
0.999989	0.999986	0.999984	0.999982	0.999981	0.999975	0.999970	0.999963	0.999957	0.999949
0.999937	0.999925	0.999907	0.999883	0.999848	0.999744	0.999683	0.999600	0.999488	0.999382].',[1], [90]);

%C1 for space view
CMBPL1correctionC1(1,:)=reshape([0.001585	0.001523	0.001439	0.001340	0.001260	0.001118	0.001060	0.001015	0.000977	0.000933
0.000902	0.000849	0.000780	0.000697	0.000608	0.000426	0.000368	0.000317	0.000278	0.000235
0.000197	0.000158	0.000130	0.000078	0.000055	0.000017	0.000014	0.000012	0.000010	0.000009
0.000008	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000003	0.000005	0.000008	0.000021	0.000031	0.000044	0.000060	0.000078
0.000113	0.000152	0.000198	0.000246	0.000294	0.000396	0.000467	0.000551	0.000624	0.000704
0.000791	0.000885	0.000978	0.001073	0.001203	0.001512	0.001701	0.002000	0.002386	0.002811].',[1], [90]);

CMBPL1correctionC1(2,:)=reshape([0.000283	0.000366	0.000355	0.000346	0.000337	0.000322	0.000317	0.000314	0.000310	0.000309
0.000307	0.000305	0.000302	0.000298	0.000294	0.000404	0.000400	0.000397	0.000394	0.000392
0.000392	0.000391	0.000255	0.000172	0.000127	0.000085	0.000050	0.000051	0.000051	0.000037
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000001	0.000000	0.000001	0.000002	0.000003	0.000005	0.000007
0.000011	0.000014	0.000016	0.000018	0.000019	0.000025	0.000030	0.000037	0.000043	0.000051
0.000063	0.000075	0.000093	0.000117	0.000152	0.000256	0.000317	0.000400	0.000512	0.000618].',[1], [90]);

CMBPL1correctionC1(3,:)=reshape([0.000226	0.000296	0.000287	0.000278	0.000317	0.000400	0.000444	0.000489	0.000534	0.000580
0.000627	0.000624	0.000620	0.000614	0.000606	0.000657	0.000606	0.000556	0.000506	0.000457
0.000409	0.000361	0.000201	0.000120	0.000121	0.000020	0.000020	0.000020	0.000021	0.000021
0.000021	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000004	0.000008	0.000015
0.000020	0.000028	0.000035	0.000044	0.000059	0.000107	0.000140	0.000171	0.000222	0.000266].',[1], [90]);

CMBPL1correctionC1(4,:)=reshape([0.001585	0.001523	0.001439	0.001340	0.001260	0.001118	0.001060	0.001015	0.000977	0.000933
0.000902	0.000849	0.000780	0.000697	0.000608	0.000426	0.000368	0.000317	0.000278	0.000235
0.000197	0.000158	0.000130	0.000078	0.000055	0.000017	0.000014	0.000012	0.000010	0.000009
0.000008	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000003	0.000005	0.000008	0.000021	0.000031	0.000044	0.000060	0.000078
0.000113	0.000152	0.000198	0.000246	0.000294	0.000396	0.000467	0.000551	0.000624	0.000704
0.000791	0.000885	0.000978	0.001073	0.001203	0.001512	0.001701	0.002000	0.002386	0.002811].',[1], [90]);

CMBPL1correctionC1(5,:)=reshape([0.000283	0.000366	0.000355	0.000346	0.000337	0.000322	0.000317	0.000314	0.000310	0.000309
0.000307	0.000305	0.000302	0.000298	0.000294	0.000404	0.000400	0.000397	0.000394	0.000392
0.000392	0.000391	0.000255	0.000172	0.000127	0.000085	0.000050	0.000051	0.000051	0.000037
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000001	0.000000	0.000001	0.000002	0.000003	0.000005	0.000007
0.000011	0.000014	0.000016	0.000018	0.000019	0.000025	0.000030	0.000037	0.000043	0.000051
0.000063	0.000075	0.000093	0.000117	0.000152	0.000256	0.000317	0.000400	0.000512	0.000618].',[1], [90]);

%C2 for platform
CMBPL1correctionC2(1,:)=reshape([0.001341	0.001213	0.001139	0.001079	0.001003	0.000849	0.000773	0.000700	0.000632	0.000566
0.000501	0.000451	0.000397	0.000357	0.000311	0.000252	0.000233	0.000209	0.000190	0.000170
0.000145	0.000127	0.000106	0.000087	0.000072	0.000038	0.000024	0.000013	0.000007	0.000003
0.000001	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000].',[1], [90]);

CMBPL1correctionC2(2,:)=reshape([0.000589	0.000481	0.000467	0.000455	0.000444	0.000422	0.000415	0.000404	0.000394	0.000382
0.000371	0.000363	0.000358	0.000352	0.000346	0.000216	0.000213	0.000210	0.000208	0.000207
0.000203	0.000201	0.000199	0.000198	0.000196	0.000167	0.000167	0.000135	0.000097	0.000074
0.000041	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000].',[1], [90]);

CMBPL1correctionC2(3,:)=reshape([0.001158	0.001061	0.001048	0.001036	0.000977	0.000858	0.000798	0.000738	0.000680	0.000622
0.000566	0.000512	0.000460	0.000406	0.000355	0.000192	0.000191	0.000190	0.000190	0.000189
0.000189	0.000188	0.000188	0.000188	0.000163	0.000127	0.000128	0.000101	0.000041	0.000041
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000].',[1], [90]);

CMBPL1correctionC2(4,:)=reshape([0.001341	0.001213	0.001139	0.001079	0.001003	0.000849	0.000773	0.000700	0.000632	0.000566
0.000501	0.000451	0.000397	0.000357	0.000311	0.000252	0.000233	0.000209	0.000190	0.000170
0.000145	0.000127	0.000106	0.000087	0.000072	0.000038	0.000024	0.000013	0.000007	0.000003
0.000001	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000].',[1], [90]);

CMBPL1correctionC2(5,:)=reshape([0.000589	0.000481	0.000467	0.000455	0.000444	0.000422	0.000415	0.000404	0.000394	0.000382
0.000371	0.000363	0.000358	0.000352	0.000346	0.000216	0.000213	0.000210	0.000208	0.000207
0.000203	0.000201	0.000199	0.000198	0.000196	0.000167	0.000167	0.000135	0.000097	0.000074
0.000041	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000
0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000	0.000000].',[1], [90]);

% fraction of total signal that IS NOT the earth signal:
CMBPL1correctionfracC0=CMBPL1correctionC0;%.^(-1)-ones(5,90); %will add to measured 
%radiance to compensate for missing earth signal. BEWARE: we assume that the
% CMB and platform actually emit 0 K!!!
CMBPL1correctionfracC1=CMBPL1correctionC1;
CMBPL1correctionfracC2=CMBPL1correctionC2;

PL2corr(1,:)=[0.24 0.24 0.24 0.24];
PL2corr(2,:)=[0.24 0.24 0.24 0.24];
PL2corr(3,:)=[0.24 0.24 0.24 0.24];
PL2corr(4,:)=[0.24 0.24 0.24 0.24];
PL2corr(5,:)=[0.24 0.24 0.24 0.24];
%in K. Transform to Radiance for each channel, add it as c4Re+c5Rpl2

SHrad=0; % = zero for all channels

% uncertainties for contamination radiances
% what is a good estimation for those uncertainties of the antenna efficiency?
uCMBPL1correctionfrac(1)=0.000001;
uCMBPL1correctionfrac(2)=0.000001;
uCMBPL1correctionfrac(3)=0.000001;
uCMBPL1correctionfrac(4)=0.000001;
uCMBPL1correctionfrac(5)=0.000001;


% these values are for MHS on noaa18 only!!! see Uncertainty document
uPL2corr(1,:)= 0.05*PL2corr(1,:);
uPL2corr(2,:)= 0.08*PL2corr(2,:);
uPL2corr(3,:)= 0.1*PL2corr(2,:);
uPL2corr(4,:)= 0.01*PL2corr(2,:); 
uPL2corr(5,:)= 0.14*PL2corr(2,:);



%% NON LINEARITY COEFFICIENTS
%anl=m*T(localoscillator)+n % need to read local oscillator temperature from l1b file. then find closest T-values in anl-table, theninterpolate linearly between them to  take corresponding anl-value for LO-Temp.


%reference non-linerarity values for 3 Temp. and 5 channels, LO-A
a1=[-1.254186E-01 -1.535102E-02 -5.114453E-02 -4.692729E-02 -7.954219E-03];
a2=[-5.638002E-03 -2.392213E-04 -2.953739E-02 -2.247278E-02 -2.606214E-03];
a3=[1.180412E-02  1.670801E-02 -1.999693E-02 -1.342902E-02 -5.011249E-04];

%reference temperature of LocalOscillator5 (LO5 or QBS5)
T1=287.55;
T2=298.55;
T3=311.25;

% calculate interpolation parameters (slope, offset)
for channel=1:5
mA=(a1(channel)-a2(channel))/(T1-T2);
nA=a2(channel)-mA*T2;

mB=(a2(channel)-a3(channel))/(T2-T3);
nB=(a3(channel)-mB*T3);

m(:,channel)=[mA mB];
n(:,channel)=[nA nB];
end




%% noise
% in ch1: 0.15K in 2006,  K in Jan-2015 for receiver noise (NedT cal.
% from dsv views);(0.21K in 2006,  K in Jan-2015 for NedT cal from OBCTviews)
% in ch2: 0.30K in 2006,  K in Jan-2015 for receiver noise (NedT cal.
% from dsv views);(0.36K in 2006,  K in Jan-2015 for NedT cal from OBCTviews)
% in ch3 : 0.41K in 2006, 0.58K in Jan-2015 for receiver noise (NedT cal.
% from dsv views); (0.5K in 2006, 0.74K in Jan-2015 for NedT cal from OBCTviews)
% in ch4: 0.32K in 2006,  K in Jan-2015 for receiver noise (NedT cal.
% from dsv views);(0.39K in 2006,  K in Jan-2015 for NedT cal from OBCTviews)
% in ch5: 0.35K in 2006,  K in Jan-2015 for receiver noise (NedT cal.
% from dsv views);(0.41K in 2006,  K in Jan-2015 for NedT cal from OBCTviews)

%uncertainties for counts (== noise on count level instead of nedt-level)
% dsv-count-allan-deviation
% counts
udsvcount(1)=22;
udsvcount(2)=45;
udsvcount(3)=60;
udsvcount(4)=43;
udsvcount(5)=53;
%NEED CORRECT VALUES per 300 scanlines, taken directly
%from allan deviation (need to access multifiles-run output?). The values
%are quite stable, so taken one value sofar. If there are larger
%deviations, what to do then?
